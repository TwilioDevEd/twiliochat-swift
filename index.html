<!DOCTYPE html><html><head><title>Twilio Chat</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Twilio Chat"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Twilio Chat</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn to implement a simple chat application using Twilio IP Messaging Client</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Twilio Chat Swift" class="chapter"><div data-title="Introduction" data-file="twiliochat/AppDelegate.swift" data-mode="swift" class="step"><h2 id="introduction">Introduction</h2>
<p>Ready to implement a chat application using Twilio IP Messaging Client?
Here is how it works at a high level:</p>
<ol>
<li><p><a href="//www.twilio.com/ip-messaging">Twilio IP Messaging</a> is the core product
we&#39;ll be using to handle all the chat functionality.</p>
</li>
<li><p>We use a server side app to generate <a href="//www.twilio.com/docs/api/ip-messaging/guides/identity#server-create-an-access-token">user access
tokens</a> which contains
all your Twilio account information. The IP Messaging Client uses this token
to connect with the API</p>
</li>
<li><p><a href="//media.twiliocdn.com/sdk/ios/common/v0.3/docs/">Twilio Common</a>
is the part of the SDK than handles access tokens and even refreshes them upon token
expiration.</p>
</li>
</ol>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/ip-messaging">IP Messaging API</a></li>
<li><a href="//www.twilio.com/docs/api/ip-messaging/guides/quickstart-ios">iOS QuickStart</a></li>
<li><a href="//www.twilio.com/docs/api/ip-messaging/guides/channels">Channels and Messages</a></li>
<li><a href="//www.twilio.com/docs/api/ip-messaging/guides/channels">User Identity &amp; Access Tokens</a></li>
<li><a href="//media.twiliocdn.com/sdk/ios/ip-messaging/v0.15/docs/">Twilio IP Messaging Client Reference</a></li>
<li><a href="//media.twiliocdn.com/sdk/ios/common/v0.3/docs/">Twilio Common Reference</a></li>
</ul>
</div><div data-title="Initializing the Client" data-file="twiliochat/IPMessagingManager.swift" data-highlight="92-123" data-mode="swift" class="step"><h2 id="initializing-the-ip-messaging-client">Initializing the IP Messaging Client</h2>
<p>The only thing you need to create a client is an access token. This token
holds information about your Twilio account and IP Messaging API keys. We have created a web
version of Twilio chat in different languages. You can use any of these to generate the token:</p>
<ul>
<li><a href="//github.com/TwilioDevEd/twiliochat-laravel">PHP - Laravel</a></li>
<li><a href="//github.com/TwilioDevEd/twiliochat-csharp">C# - .NET MVC</a></li>
<li><a href="//github.com/TwilioDevEd/twiliochat-servlets">Java - Servlets</a></li>
<li><a href="//github.com/TwilioDevEd/twiliochat-node">JS - Node</a></li>
</ul>
<p>We use <a href="//github.com/Alamofire/Alamofire">Alamofire</a>
to make a request to our server and get the access token.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//github.com/Alamofire/Alamofire">Alamofire HTTP Requests</a></li>
</ul>
</div><div data-title="Synchronizing the Client" data-file="twiliochat/IPMessagingManager.swift" data-highlight="145-157" data-mode="swift" class="step"><h2 id="synchronizing-the-ip-messaging-client">Synchronizing the IP Messaging Client</h2>
<p>In the previous step we initialized the
<a href="//media.twiliocdn.com/sdk/ios/ip-messaging/releases/0.15.1/docs/Classes/TwilioIPMessagingClient.html">IP Messaging client</a>
with an <a href="//media.twiliocdn.com/sdk/ios/common/releases/0.3.3/docs/Classes/TwilioAccessManager.html">access manager</a>
and set the client&#39;s delegate to the shared instance of our <code>IPMessagingManager</code>.</p>
<p>The <code>synchronizationStatusChanged</code>
<a href="//media.twiliocdn.com/sdk/ios/ip-messaging/releases/0.15.1/docs/Protocols/TwilioIPMessagingClientDelegate.html">delegate</a>
method will allow us to know when the client has loaded all the required information.
You can change the default initialization values for the client using a
<a href="//media.twiliocdn.com/sdk/ios/ip-messaging/releases/0.15.1/docs/Classes/TwilioIPMessagingClientProperties.html">TwilioIPMessagingClientProperties</a>
instance as the <code>options</code> parameter in the previews step.</p>
<p>We need the client to be synchronized before trying to get the channel list (next step).
Otherwise, calling <a href="//media.twiliocdn.com/sdk/ios/ip-messaging/releases/0.15.1/docs/Classes/TwilioIPMessagingClient.html#//api/name/channelsList">client.channelsList()</a>
will return <code>nil</code>.</p>
</div><div data-title="Getting the Channel List" data-file="twiliochat/ChannelManager.swift" data-highlight="73-89" data-mode="swift" class="step"><h2 id="getting-the-channel-list">Getting the Channel List</h2>
<p>Our <code>ChannelManager</code> class takes care of everything related to channels.
In the previous step, we waited for the client to synchronize channel information,
and assigned an instance of
<a href="//media.twiliocdn.com/sdk/ios/ip-messaging/releases/0.15.1/docs/Classes/TWMChannels.html">TWMChannelList</a>
to our <code>ChannelManager</code>. Now we must get an actual array of channels using
the <code>allObjects()</code> method.</p>
</div><div data-title="Listen to Client Events" data-file="twiliochat/ChannelManager.swift" data-highlight="111-138" data-mode="swift" class="step"><h2 id="listen-to-client-events">Listen to Client Events</h2>
<p>The IP Messaging Client will trigger events such as <code>channelAdded</code> or <code>channelDeleted</code>
on our application. Given the creation or deletion of a channel, we&#39;ll reload the
channel list in the reveal controller. If a channel is deleted and we were currently joined to that
channel, the application will automatically join the general channel.</p>
<p><code>ChannelManager</code> is a <code>TwilioIPMessagingClientDelegate</code>. In this class we
implement the delegate methods, but we also allow <code>MenuViewController</code>
class to be a delegate of ChannelManager, so it can listen to client events too.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//media.twiliocdn.com/sdk/ios/ip-messaging/releases/0.15.1/docs/Protocols/TwilioIPMessagingClientDelegate.html">TwilioIPMessagingClientDelegate Protocol Reference</a></li>
</ul>
</div><div data-title="Join the General Channel" data-file="twiliochat/ChannelManager.swift" data-highlight="22-69" data-mode="swift" class="step"><h2 id="join-the-general-channel">Join the General Channel</h2>
<p>This application will try to join a channel called &quot;General Channel&quot; when it starts.
If the channel doesn&#39;t exist, it&#39;ll create one with that name. The scope of
this example application will show you how to work only with public channels,
but the IP Messaging client allows you to create private channels and handle
invitations.</p>
<p>Once you have joined a channel, you can register a class as the <code>TWMChannelDelegate</code>
so you can start listening to events such as <code>messageAdded</code> or <code>memberJoined</code>.
We&#39;ll show you how to do this in the next step.</p>
</div><div data-title="Listen to Channel Events" data-file="twiliochat/MainChatViewController.swift" data-highlight="223-256" data-mode="swift" class="step"><h2 id="listen-to-channel-events">Listen to Channel Events</h2>
<p>We registered <code>MainChatViewController</code> as the <code>TWMChannelDelegate</code>, and here
we implemented the following methods that listen to channel events:</p>
<ul>
<li><code>messageAdded</code>: When someone sends a message to the channel you are connected to.</li>
<li><code>channelDeleted</code>: When someone deletes a channel.</li>
<li><code>memberJoined</code>: When someone joins the channel.</li>
<li><code>memberLeft</code>: When someone leaves the channel.</li>
<li><code>synchronizationStatusChanged</code>: When channel synchronization status changes.</li>
</ul>
<p>As you may have noticed, each one of these methods include useful objects
as parameters. One example is the actual message that was added to the channel.</p>
</div><div data-title="Joining Other Channels" data-file="twiliochat/MainChatViewController.swift" data-highlight="131-152" data-mode="swift" class="step"><h2 id="joining-other-channels">Joining Other Channels</h2>
<p>The application uses <a href="//github.com/John-Lluch/SWRevealViewController">SWRevealViewController</a>
to show a sidebar that contains a list of the channels created for that Twilio account.</p>
<p>When you tap on the name of a channel from the sidebar, that channel is set
on the <code>MainChatViewController</code>. The <code>joinChannel</code> method takes care of joining
to the selected channel and loading the messages.</p>
</div><div data-title="Creating a Channel" data-file="twiliochat/ChannelManager.swift" data-highlight="93-107" data-mode="swift" class="step"><h2 id="creating-a-channel">Creating a Channel</h2>
<p>We use an input dialog so the user can type the name of the new channel.
The only restriction here is that the user can&#39;t create a channel called
&quot;General Channel&quot;. Other than that, creating a channel is as simple as calling
<code>createChannelWithOptions</code> and passing a dictionary with the new channel information.</p>
</div><div data-title="Deleting a Channel" data-file="twiliochat/MenuViewController.swift" data-highlight="155-170" data-mode="swift" class="step"><h2 id="deleting-a-channel">Deleting a Channel</h2>
<p>Deleting a channel is easier than creating one. We&#39;ll use the <code>UITableView</code>
ability to delete a cell. Once you have figured out what channel is meant
to be deleted (from the selected cell index path), deleting it is as simple
as calling the channel&#39;s method <code>destroyWithCompletion</code>.</p>
</div><div data-title="Where to Next?" class="step"><h2 id="where-to-next-">Where to Next?</h2>
<p>That&#39;s it! We&#39;ve just implemented a simple chat application using Swift.
If you are am iOS developer working with Twilio, you might want
to check out these other projects:</p>
<p><a href="//github.com/TwilioDevEd/client-quickstart-swift"><strong>Client Quickstart</strong></a></p>
<p>Twilio Client for iOS Quickstart using Swift</p>
<p><a href="//github.com/TwilioDevEd/notifications-quickstart-swift"><strong>Notifications Quickstart</strong></a></p>
<p>Twilio Notifications for iOS Quickstart using Swift</p>
<h2 id="did-this-help-">Did this help?</h2>
<p>Thanks for checking this tutorial out! If you have any feedback to share with us,
we&#39;d love to hear it. <a href="mailto:deved-oss@twilio.com">Contact the Twilio Developer Education Team</a>
to let us know what you think.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="twiliochat/AppDelegate.swift" data-mode="swift">aW1wb3J0IFVJS2l0CgpAVUlBcHBsaWNhdGlvbk1haW4KY2xhc3MgQXBwRGVsZWdhdGU6IFVJUmVzcG9uZGVyLCBVSUFwcGxpY2F0aW9uRGVsZWdhdGUgewogIHZhciB3aW5kb3c6IFVJV2luZG93PwoKICBmdW5jIGFwcGxpY2F0aW9uKGFwcGxpY2F0aW9uOiBVSUFwcGxpY2F0aW9uLCBkaWRGaW5pc2hMYXVuY2hpbmdXaXRoT3B0aW9ucyBsYXVuY2hPcHRpb25zOiBbTlNPYmplY3Q6IEFueU9iamVjdF0/KSAtPiBCb29sIHsKICAgIElQTWVzc2FnaW5nTWFuYWdlci5zaGFyZWRNYW5hZ2VyKCkucHJlc2VudExhdW5jaFNjcmVlbigpCiAgICBJUE1lc3NhZ2luZ01hbmFnZXIuc2hhcmVkTWFuYWdlcigpLnByZXNlbnRSb290Vmlld0NvbnRyb2xsZXIoKQogICAgcmV0dXJuIHRydWUKICB9CgogIGZ1bmMgYXBwbGljYXRpb25XaWxsUmVzaWduQWN0aXZlKGFwcGxpY2F0aW9uOiBVSUFwcGxpY2F0aW9uKSB7CiAgICAvLyBTZW50IHdoZW4gdGhlIGFwcGxpY2F0aW9uIGlzIGFib3V0IHRvIG1vdmUgZnJvbSBhY3RpdmUgdG8gaW5hY3RpdmUgc3RhdGUuIFRoaXMgY2FuIG9jY3VyIGZvciBjZXJ0YWluIHR5cGVzIG9mIHRlbXBvcmFyeSBpbnRlcnJ1cHRpb25zIChzdWNoIGFzIGFuIGluY29taW5nIHBob25lIGNhbGwgb3IgU01TIG1lc3NhZ2UpIG9yIHdoZW4gdGhlIHVzZXIgcXVpdHMgdGhlIGFwcGxpY2F0aW9uIGFuZCBpdCBiZWdpbnMgdGhlIHRyYW5zaXRpb24gdG8gdGhlIGJhY2tncm91bmQgc3RhdGUuCiAgICAvLyBVc2UgdGhpcyBtZXRob2QgdG8gcGF1c2Ugb25nb2luZyB0YXNrcywgZGlzYWJsZSB0aW1lcnMsIGFuZCB0aHJvdHRsZSBkb3duIE9wZW5HTCBFUyBmcmFtZSByYXRlcy4gR2FtZXMgc2hvdWxkIHVzZSB0aGlzIG1ldGhvZCB0byBwYXVzZSB0aGUgZ2FtZS4KICB9CgogIGZ1bmMgYXBwbGljYXRpb25EaWRFbnRlckJhY2tncm91bmQoYXBwbGljYXRpb246IFVJQXBwbGljYXRpb24pIHsKICAgIC8vIFVzZSB0aGlzIG1ldGhvZCB0byByZWxlYXNlIHNoYXJlZCByZXNvdXJjZXMsIHNhdmUgdXNlciBkYXRhLCBpbnZhbGlkYXRlIHRpbWVycywgYW5kIHN0b3JlIGVub3VnaCBhcHBsaWNhdGlvbiBzdGF0ZSBpbmZvcm1hdGlvbiB0byByZXN0b3JlIHlvdXIgYXBwbGljYXRpb24gdG8gaXRzIGN1cnJlbnQgc3RhdGUgaW4gY2FzZSBpdCBpcyB0ZXJtaW5hdGVkIGxhdGVyLgogICAgLy8gSWYgeW91ciBhcHBsaWNhdGlvbiBzdXBwb3J0cyBiYWNrZ3JvdW5kIGV4ZWN1dGlvbiwgdGhpcyBtZXRob2QgaXMgY2FsbGVkIGluc3RlYWQgb2YgYXBwbGljYXRpb25XaWxsVGVybWluYXRlOiB3aGVuIHRoZSB1c2VyIHF1aXRzLgogIH0KCiAgZnVuYyBhcHBsaWNhdGlvbldpbGxFbnRlckZvcmVncm91bmQoYXBwbGljYXRpb246IFVJQXBwbGljYXRpb24pIHsKICAgIC8vIENhbGxlZCBhcyBwYXJ0IG9mIHRoZSB0cmFuc2l0aW9uIGZyb20gdGhlIGJhY2tncm91bmQgdG8gdGhlIGluYWN0aXZlIHN0YXRlIGhlcmUgeW91IGNhbiB1bmRvIG1hbnkgb2YgdGhlIGNoYW5nZXMgbWFkZSBvbiBlbnRlcmluZyB0aGUgYmFja2dyb3VuZC4KICB9CgogIGZ1bmMgYXBwbGljYXRpb25EaWRCZWNvbWVBY3RpdmUoYXBwbGljYXRpb246IFVJQXBwbGljYXRpb24pIHsKICAgIC8vIFJlc3RhcnQgYW55IHRhc2tzIHRoYXQgd2VyZSBwYXVzZWQgKG9yIG5vdCB5ZXQgc3RhcnRlZCkgd2hpbGUgdGhlIGFwcGxpY2F0aW9uIHdhcyBpbmFjdGl2ZS4gSWYgdGhlIGFwcGxpY2F0aW9uIHdhcyBwcmV2aW91c2x5IGluIHRoZSBiYWNrZ3JvdW5kLCBvcHRpb25hbGx5IHJlZnJlc2ggdGhlIHVzZXIgaW50ZXJmYWNlLgogIH0KCiAgZnVuYyBhcHBsaWNhdGlvbldpbGxUZXJtaW5hdGUoYXBwbGljYXRpb246IFVJQXBwbGljYXRpb24pIHsKICAgIC8vIENhbGxlZCB3aGVuIHRoZSBhcHBsaWNhdGlvbiBpcyBhYm91dCB0byB0ZXJtaW5hdGUuIFNhdmUgZGF0YSBpZiBhcHByb3ByaWF0ZS4gU2VlIGFsc28gYXBwbGljYXRpb25EaWRFbnRlckJhY2tncm91bmQ6LgogIH0KCgp9Cgo=</textarea>
<textarea class="saurus-file" data-file="twiliochat/IPMessagingManager.swift" data-mode="swift">aW1wb3J0IFVJS2l0CgpjbGFzcyBJUE1lc3NhZ2luZ01hbmFnZXI6IE5TT2JqZWN0IHsKCiAgc3RhdGljIGxldCBfc2hhcmVkTWFuYWdlciA9IElQTWVzc2FnaW5nTWFuYWdlcigpCgogIHZhciBjbGllbnQ6VHdpbGlvSVBNZXNzYWdpbmdDbGllbnQ/CiAgdmFyIGRlbGVnYXRlOkNoYW5uZWxNYW5hZ2VyPwogIHZhciBjb25uZWN0ZWQgPSBmYWxzZQoKICB2YXIgdXNlcklkZW50aXR5OlN0cmluZyB7CiAgICByZXR1cm4gU2Vzc2lvbk1hbmFnZXIuZ2V0VXNlcm5hbWUoKQogIH0KCiAgdmFyIGhhc0lkZW50aXR5OiBCb29sIHsKICAgIHJldHVybiBTZXNzaW9uTWFuYWdlci5pc0xvb2dlZEluKCkKICB9CgogIG92ZXJyaWRlIGluaXQoKSB7CiAgICBzdXBlci5pbml0KCkKICAgIGRlbGVnYXRlID0gQ2hhbm5lbE1hbmFnZXIuc2hhcmVkTWFuYWdlcgogIH0KCiAgY2xhc3MgZnVuYyBzaGFyZWRNYW5hZ2VyKCkgLT4gSVBNZXNzYWdpbmdNYW5hZ2VyIHsKICAgIHJldHVybiBfc2hhcmVkTWFuYWdlcgogIH0KCiAgZnVuYyBwcmVzZW50Um9vdFZpZXdDb250cm9sbGVyKCkgewogICAgaWYgKCFoYXNJZGVudGl0eSkgewogICAgICBwcmVzZW50Vmlld0NvbnRyb2xsZXJCeU5hbWUoIkxvZ2luVmlld0NvbnRyb2xsZXIiKQogICAgICByZXR1cm4KICAgIH0KCiAgICBpZiAoIWNvbm5lY3RlZCkgewogICAgICBjb25uZWN0Q2xpZW50V2l0aENvbXBsZXRpb24geyBzdWNjZXNzLCBlcnJvciBpbgogICAgICAgIHByaW50KCJEZWxlZ2F0ZSBtZXRob2Qgd2lsbCBsb2FkIHZpZXdzIHdoZW4gc3luYyBpcyBjb21wbGV0ZSIpCiAgICAgIH0KICAgICAgcmV0dXJuCiAgICB9CgogICAgcHJlc2VudFZpZXdDb250cm9sbGVyQnlOYW1lKCJSZXZlYWxWaWV3Q29udHJvbGxlciIpCiAgfQoKICBmdW5jIHByZXNlbnRWaWV3Q29udHJvbGxlckJ5TmFtZSh2aWV3Q29udHJvbGxlcjogU3RyaW5nKSB7CiAgICBwcmVzZW50Vmlld0NvbnRyb2xsZXIoc3RvcnlCb2FyZFdpdGhOYW1lKCJNYWluIikuaW5zdGFudGlhdGVWaWV3Q29udHJvbGxlcldpdGhJZGVudGlmaWVyKHZpZXdDb250cm9sbGVyKSkKICB9CgogIGZ1bmMgcHJlc2VudExhdW5jaFNjcmVlbigpIHsKICAgIHByZXNlbnRWaWV3Q29udHJvbGxlcihzdG9yeUJvYXJkV2l0aE5hbWUoIkxhdW5jaFNjcmVlbiIpLmluc3RhbnRpYXRlSW5pdGlhbFZpZXdDb250cm9sbGVyKCkhKQogIH0KCiAgZnVuYyBwcmVzZW50Vmlld0NvbnRyb2xsZXIoY29udHJvbGxlcjogVUlWaWV3Q29udHJvbGxlcikgewogICAgbGV0IHdpbmRvdyA9IFVJQXBwbGljYXRpb24uc2hhcmVkQXBwbGljYXRpb24oKS5kZWxlZ2F0ZSEud2luZG93ISEKICAgIHdpbmRvdy5yb290Vmlld0NvbnRyb2xsZXIgPSBjb250cm9sbGVyCiAgfQoKICBmdW5jIHN0b3J5Qm9hcmRXaXRoTmFtZShuYW1lOlN0cmluZykgLT4gVUlTdG9yeWJvYXJkIHsKICAgIHJldHVybiBVSVN0b3J5Ym9hcmQobmFtZTpuYW1lLCBidW5kbGU6IE5TQnVuZGxlLm1haW5CdW5kbGUoKSkKICB9CgogIC8vIE1BUks6IFVzZXIgYW5kIHNlc3Npb24gbWFuYWdlbWVudAoKICBmdW5jIGxvZ2luV2l0aFVzZXJuYW1lKHVzZXJuYW1lOiBTdHJpbmcsCiAgICBjb21wbGV0aW9uOiAoQm9vbCwgTlNFcnJvcj8pIC0+IFZvaWQpIHsKICAgICAgU2Vzc2lvbk1hbmFnZXIubG9naW5XaXRoVXNlcm5hbWUodXNlcm5hbWUpCiAgICAgIGNvbm5lY3RDbGllbnRXaXRoQ29tcGxldGlvbihjb21wbGV0aW9uKQogIH0KCiAgZnVuYyBsb2dvdXQoKSB7CiAgICBTZXNzaW9uTWFuYWdlci5sb2dvdXQoKQogICAgZGlzcGF0Y2hfYXN5bmMoZGlzcGF0Y2hfZ2V0X2dsb2JhbF9xdWV1ZShESVNQQVRDSF9RVUVVRV9QUklPUklUWV9ERUZBVUxULCAwKSkgewogICAgICBzZWxmLmNsaWVudD8uc2h1dGRvd24oKQogICAgICBzZWxmLmNsaWVudCA9IG5pbAogICAgfQogICAgc2VsZi5jb25uZWN0ZWQgPSBmYWxzZQogIH0KCiAgLy8gTUFSSzogVHdpbGlvIENsaWVudAoKICBmdW5jIGxvYWRHZW5lcmFsQ2hhdFJvb21XaXRoQ29tcGxldGlvbihjb21wbGV0aW9uOihCb29sLCBOU0Vycm9yPykgLT4gVm9pZCkgewogICAgQ2hhbm5lbE1hbmFnZXIuc2hhcmVkTWFuYWdlci5qb2luR2VuZXJhbENoYXRSb29tV2l0aENvbXBsZXRpb24geyBzdWNjZWVkZWQgaW4KICAgICAgaWYgc3VjY2VlZGVkIHsKICAgICAgICBjb21wbGV0aW9uKHN1Y2NlZWRlZCwgbmlsKQogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIGxldCBlcnJvciA9IHNlbGYuZXJyb3JXaXRoRGVzY3JpcHRpb24oIkNvdWxkIG5vdCBqb2luIEdlbmVyYWwgY2hhbm5lbCIsIGNvZGU6IDMwMCkKICAgICAgICBjb21wbGV0aW9uKHN1Y2NlZWRlZCwgZXJyb3IpCiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmMgY29ubmVjdENsaWVudFdpdGhDb21wbGV0aW9uKGNvbXBsZXRpb246IChCb29sLCBOU0Vycm9yPykgLT4gVm9pZCkgewogICAgaWYgKGNsaWVudCAhPSBuaWwpIHsKICAgICAgbG9nb3V0KCkKICAgIH0KCiAgICByZXF1ZXN0VG9rZW5XaXRoQ29tcGxldGlvbiB7IHN1Y2NlZWRlZCwgdG9rZW4gaW4KICAgICAgaWYgbGV0IHRva2VuID0gdG9rZW4gd2hlcmUgc3VjY2VlZGVkIHsKICAgICAgICBzZWxmLmluaXRpYWxpemVDbGllbnRXaXRoVG9rZW4odG9rZW4pCiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgbGV0IGVycm9yID0gc2VsZi5lcnJvcldpdGhEZXNjcmlwdGlvbigiQ291bGQgbm90IGdldCBhY2Nlc3MgdG9rZW4iLCBjb2RlOjMwMSkKICAgICAgICBjb21wbGV0aW9uKHN1Y2NlZWRlZCwgZXJyb3IpCiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmMgaW5pdGlhbGl6ZUNsaWVudFdpdGhUb2tlbih0b2tlbjogU3RyaW5nKSB7CiAgICBsZXQgYWNjZXNzTWFuYWdlciA9IFR3aWxpb0FjY2Vzc01hbmFnZXIodG9rZW46dG9rZW4sIGRlbGVnYXRlOnNlbGYpCiAgICBjbGllbnQgPSBUd2lsaW9JUE1lc3NhZ2luZ0NsaWVudC5pcE1lc3NhZ2luZ0NsaWVudFdpdGhBY2Nlc3NNYW5hZ2VyKGFjY2Vzc01hbmFnZXIsIHByb3BlcnRpZXM6IG5pbCwgZGVsZWdhdGU6IHNlbGYpCiAgICBVSUFwcGxpY2F0aW9uLnNoYXJlZEFwcGxpY2F0aW9uKCkubmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSA9IHRydWUKICAgIHNlbGYuY29ubmVjdGVkID0gdHJ1ZQogIH0KCiAgZnVuYyByZXF1ZXN0VG9rZW5XaXRoQ29tcGxldGlvbihjb21wbGV0aW9uOihCb29sLCBTdHJpbmc/KSAtPiBWb2lkKSB7CiAgICBpZiBsZXQgZGV2aWNlID0gVUlEZXZpY2UuY3VycmVudERldmljZSgpLmlkZW50aWZpZXJGb3JWZW5kb3I/LlVVSURTdHJpbmcgewogICAgICBUb2tlblJlcXVlc3RIYW5kbGVyLmZldGNoVG9rZW4oWyJkZXZpY2UiOiBkZXZpY2UsICJpZGVudGl0eSI6U2Vzc2lvbk1hbmFnZXIuZ2V0VXNlcm5hbWUoKV0pIHtyZXNwb25zZSxlcnJvciBpbgogICAgICAgIHZhciB0b2tlbjogU3RyaW5nPwogICAgICAgIHRva2VuID0gcmVzcG9uc2VbInRva2VuIl0gYXM/IFN0cmluZwogICAgICAgIGNvbXBsZXRpb24odG9rZW4gIT0gbmlsLCB0b2tlbikKICAgICAgfQogICAgfQogIH0KCiAgZnVuYyBlcnJvcldpdGhEZXNjcmlwdGlvbihkZXNjcmlwdGlvbjogU3RyaW5nLCBjb2RlOiBJbnQpIC0+IE5TRXJyb3IgewogICAgbGV0IHVzZXJJbmZvID0gW05TTG9jYWxpemVkRGVzY3JpcHRpb25LZXkgOiBkZXNjcmlwdGlvbl0KICAgIHJldHVybiBOU0Vycm9yKGRvbWFpbjogImFwcCIsIGNvZGU6IGNvZGUsIHVzZXJJbmZvOiB1c2VySW5mbykKICB9Cn0KCi8vIE1BUks6IC0gVHdpbGlvSVBNZXNzYWdpbmdDbGllbnREZWxlZ2F0ZQpleHRlbnNpb24gSVBNZXNzYWdpbmdNYW5hZ2VyIDogVHdpbGlvSVBNZXNzYWdpbmdDbGllbnREZWxlZ2F0ZSB7CiAgZnVuYyBpcE1lc3NhZ2luZ0NsaWVudChjbGllbnQ6IFR3aWxpb0lQTWVzc2FnaW5nQ2xpZW50ISwgY2hhbm5lbEFkZGVkIGNoYW5uZWw6IFRXTUNoYW5uZWwhKSB7CiAgICBzZWxmLmRlbGVnYXRlPy5pcE1lc3NhZ2luZ0NsaWVudChjbGllbnQsIGNoYW5uZWxBZGRlZDogY2hhbm5lbCkKICB9CgogIGZ1bmMgaXBNZXNzYWdpbmdDbGllbnQoY2xpZW50OiBUd2lsaW9JUE1lc3NhZ2luZ0NsaWVudCEsIGNoYW5uZWxDaGFuZ2VkIGNoYW5uZWw6IFRXTUNoYW5uZWwhKSB7CiAgICBzZWxmLmRlbGVnYXRlPy5pcE1lc3NhZ2luZ0NsaWVudChjbGllbnQsIGNoYW5uZWxDaGFuZ2VkOiBjaGFubmVsKQogIH0KCiAgZnVuYyBpcE1lc3NhZ2luZ0NsaWVudChjbGllbnQ6IFR3aWxpb0lQTWVzc2FnaW5nQ2xpZW50ISwgY2hhbm5lbERlbGV0ZWQgY2hhbm5lbDogVFdNQ2hhbm5lbCEpIHsKICAgIHNlbGYuZGVsZWdhdGU/LmlwTWVzc2FnaW5nQ2xpZW50KGNsaWVudCwgY2hhbm5lbERlbGV0ZWQ6IGNoYW5uZWwpCiAgfQoKICBmdW5jIGlwTWVzc2FnaW5nQ2xpZW50KGNsaWVudDogVHdpbGlvSVBNZXNzYWdpbmdDbGllbnQhLCBzeW5jaHJvbml6YXRpb25TdGF0dXNDaGFuZ2VkIHN0YXR1czogVFdNQ2xpZW50U3luY2hyb25pemF0aW9uU3RhdHVzKSB7CiAgICBpZiBzdGF0dXMgPT0gVFdNQ2xpZW50U3luY2hyb25pemF0aW9uU3RhdHVzLkNvbXBsZXRlZCB7CiAgICAgIFVJQXBwbGljYXRpb24uc2hhcmVkQXBwbGljYXRpb24oKS5uZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlID0gZmFsc2UKICAgICAgQ2hhbm5lbE1hbmFnZXIuc2hhcmVkTWFuYWdlci5jaGFubmVsc0xpc3QgPSBjbGllbnQuY2hhbm5lbHNMaXN0KCkKICAgICAgQ2hhbm5lbE1hbmFnZXIuc2hhcmVkTWFuYWdlci5wb3B1bGF0ZUNoYW5uZWxzKCkKICAgICAgbG9hZEdlbmVyYWxDaGF0Um9vbVdpdGhDb21wbGV0aW9uIHsgc3VjY2VzcywgZXJyb3IgaW4KICAgICAgICBpZiBzdWNjZXNzIHsKICAgICAgICAgIHNlbGYucHJlc2VudFJvb3RWaWV3Q29udHJvbGxlcigpCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBzZWxmLmRlbGVnYXRlPy5pcE1lc3NhZ2luZ0NsaWVudChjbGllbnQsIHN5bmNocm9uaXphdGlvblN0YXR1c0NoYW5nZWQ6IHN0YXR1cykKICB9Cn0KCi8vIE1BUks6IC0gVHdpbGlvQWNjZXNzTWFuYWdlckRlbGVnYXRlCmV4dGVuc2lvbiBJUE1lc3NhZ2luZ01hbmFnZXIgOiBUd2lsaW9BY2Nlc3NNYW5hZ2VyRGVsZWdhdGUgewogIGZ1bmMgYWNjZXNzTWFuYWdlclRva2VuRXhwaXJlZChhY2Nlc3NNYW5hZ2VyOiBUd2lsaW9BY2Nlc3NNYW5hZ2VyISkgewogICAgcmVxdWVzdFRva2VuV2l0aENvbXBsZXRpb24geyBzdWNjZWVkZWQsIHRva2VuIGluCiAgICAgIGlmIChzdWNjZWVkZWQpIHsKICAgICAgICBhY2Nlc3NNYW5hZ2VyLnVwZGF0ZVRva2VuKHRva2VuKQogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHByaW50KCJFcnJvciB3aGlsZSB0cnlpbmcgdG8gZ2V0IG5ldyBhY2Nlc3MgdG9rZW4iKQogICAgICB9CiAgICB9CiAgfQoKICBmdW5jIGFjY2Vzc01hbmFnZXIoYWNjZXNzTWFuYWdlcjogVHdpbGlvQWNjZXNzTWFuYWdlciEsIGVycm9yOiBOU0Vycm9yISkgewogICAgcHJpbnQoIkFjY2VzcyBtYW5hZ2VyIGVycm9yOiBcKGVycm9yLmxvY2FsaXplZERlc2NyaXB0aW9uKSIpCiAgfQp9Cg==</textarea>
<textarea class="saurus-file" data-file="twiliochat/ChannelManager.swift" data-mode="swift">aW1wb3J0IFVJS2l0CgpjbGFzcyBDaGFubmVsTWFuYWdlcjogTlNPYmplY3QgewogIHN0YXRpYyBsZXQgc2hhcmVkTWFuYWdlciA9IENoYW5uZWxNYW5hZ2VyKCkKCiAgc3RhdGljIGxldCBkZWZhdWx0Q2hhbm5lbFVuaXF1ZU5hbWUgPSAiZ2VuZXJhbCIKICBzdGF0aWMgbGV0IGRlZmF1bHRDaGFubmVsTmFtZSA9ICJHZW5lcmFsIENoYW5uZWwiCgogIHdlYWsgdmFyIGRlbGVnYXRlOk1lbnVWaWV3Q29udHJvbGxlcj8KCiAgdmFyIGNoYW5uZWxzTGlzdDpUV01DaGFubmVscz8KICB2YXIgY2hhbm5lbHM6TlNNdXRhYmxlT3JkZXJlZFNldD8KICB2YXIgZ2VuZXJhbENoYW5uZWw6VFdNQ2hhbm5lbCEKCiAgb3ZlcnJpZGUgaW5pdCgpIHsKICAgIHN1cGVyLmluaXQoKQogICAgY2hhbm5lbHMgPSBOU011dGFibGVPcmRlcmVkU2V0KCkKICB9CgogIC8vIE1BUks6IC0gR2VuZXJhbCBjaGFubmVsCgogIGZ1bmMgam9pbkdlbmVyYWxDaGF0Um9vbVdpdGhDb21wbGV0aW9uKGNvbXBsZXRpb246IEJvb2wgLT4gVm9pZCkgewoKICAgIGxldCB1bmlxdWVOYW1lID0gQ2hhbm5lbE1hbmFnZXIuZGVmYXVsdENoYW5uZWxVbmlxdWVOYW1lCiAgICBpZiBsZXQgY2hhbm5lbHNMaXN0ID0gc2VsZi5jaGFubmVsc0xpc3QgewogICAgICBzZWxmLmdlbmVyYWxDaGFubmVsID0gY2hhbm5lbHNMaXN0LmNoYW5uZWxXaXRoVW5pcXVlTmFtZSh1bmlxdWVOYW1lKQogICAgfQoKICAgIGlmIHNlbGYuZ2VuZXJhbENoYW5uZWwgIT0gbmlsIHsKICAgICAgc2VsZi5qb2luR2VuZXJhbENoYXRSb29tV2l0aFVuaXF1ZU5hbWUobmlsLCBjb21wbGV0aW9uOiBjb21wbGV0aW9uKQogICAgICByZXR1cm4KICAgIH0KCiAgICBzZWxmLmNyZWF0ZUdlbmVyYWxDaGF0Um9vbVdpdGhDb21wbGV0aW9uIHsgc3VjY2VlZGVkIGluCiAgICAgIGlmIChzdWNjZWVkZWQpIHsKICAgICAgICBzZWxmLmpvaW5HZW5lcmFsQ2hhdFJvb21XaXRoVW5pcXVlTmFtZSh1bmlxdWVOYW1lLCBjb21wbGV0aW9uOiBjb21wbGV0aW9uKQogICAgICAgIHJldHVybgogICAgICB9CgogICAgICBjb21wbGV0aW9uKGZhbHNlKQogICAgfQogIH0KCiAgZnVuYyBqb2luR2VuZXJhbENoYXRSb29tV2l0aFVuaXF1ZU5hbWUobmFtZTogU3RyaW5nPywgY29tcGxldGlvbjogQm9vbCAtPiBWb2lkKSB7CiAgICBnZW5lcmFsQ2hhbm5lbC5qb2luV2l0aENvbXBsZXRpb24geyByZXN1bHQgaW4KICAgICAgaWYgKHJlc3VsdC5pc1N1Y2Nlc3NmdWwoKSAmJiBuYW1lICE9IG5pbCkgewogICAgICAgIHNlbGYuc2V0R2VuZXJhbENoYXRSb29tVW5pcXVlTmFtZVdpdGhDb21wbGV0aW9uKGNvbXBsZXRpb24pCiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgY29tcGxldGlvbihyZXN1bHQuaXNTdWNjZXNzZnVsKCkpCiAgICB9CiAgfQoKICBmdW5jIGNyZWF0ZUdlbmVyYWxDaGF0Um9vbVdpdGhDb21wbGV0aW9uKGNvbXBsZXRpb246IEJvb2wgLT4gVm9pZCkgewogICAgbGV0IGNoYW5uZWxOYW1lID0gQ2hhbm5lbE1hbmFnZXIuZGVmYXVsdENoYW5uZWxOYW1lCiAgICBsZXQgb3B0aW9uczpbTlNPYmplY3QgOiBBbnlPYmplY3RdID0gW1RXTUNoYW5uZWxPcHRpb25GcmllbmRseU5hbWU6IGNoYW5uZWxOYW1lLCBUV01DaGFubmVsT3B0aW9uVHlwZTogVFdNQ2hhbm5lbFR5cGUuUHVibGljLnJhd1ZhbHVlXQogICAgY2hhbm5lbHNMaXN0IS5jcmVhdGVDaGFubmVsV2l0aE9wdGlvbnMob3B0aW9ucykgeyByZXN1bHQsIGNoYW5uZWwgaW4KICAgICAgaWYgcmVzdWx0LmlzU3VjY2Vzc2Z1bCgpIHsKICAgICAgICBzZWxmLmdlbmVyYWxDaGFubmVsID0gY2hhbm5lbAogICAgICB9CiAgICAgIGNvbXBsZXRpb24ocmVzdWx0LmlzU3VjY2Vzc2Z1bCgpKQogICAgfQogIH0KCiAgZnVuYyBzZXRHZW5lcmFsQ2hhdFJvb21VbmlxdWVOYW1lV2l0aENvbXBsZXRpb24oY29tcGxldGlvbjpCb29sIC0+IFZvaWQpIHsKICAgIGdlbmVyYWxDaGFubmVsLnNldFVuaXF1ZU5hbWUoQ2hhbm5lbE1hbmFnZXIuZGVmYXVsdENoYW5uZWxVbmlxdWVOYW1lKSB7IHJlc3VsdCBpbgogICAgICBjb21wbGV0aW9uKHJlc3VsdC5pc1N1Y2Nlc3NmdWwoKSkKICAgIH0KICB9CgogIC8vIE1BUks6IC0gUG9wdWxhdGUgY2hhbm5lbHMKICAKICBmdW5jIHBvcHVsYXRlQ2hhbm5lbHMoKSB7CiAgICBjaGFubmVscyA9IE5TTXV0YWJsZU9yZGVyZWRTZXQoKQogICAgaWYgbGV0IGNoYW5uZWxzID0gY2hhbm5lbHNMaXN0Py5hbGxPYmplY3RzKCkgewogICAgICBzZWxmLmNoYW5uZWxzPy5hZGRPYmplY3RzRnJvbUFycmF5KGNoYW5uZWxzKQogICAgICBzb3J0Q2hhbm5lbHMoKQogICAgfQogICAgCiAgICBpZiBzZWxmLmRlbGVnYXRlICE9IG5pbCB7CiAgICAgIHNlbGYuZGVsZWdhdGUhLnJlbG9hZENoYW5uZWxMaXN0KCkKICAgIH0KICB9CgogIGZ1bmMgc29ydENoYW5uZWxzKCkgewogICAgbGV0IHNvcnRTZWxlY3RvciA9ICNzZWxlY3RvcihOU1N0cmluZy5sb2NhbGl6ZWRDYXNlSW5zZW5zaXRpdmVDb21wYXJlKF86KSkKICAgIGxldCBkZXNjcmlwdG9yID0gTlNTb3J0RGVzY3JpcHRvcihrZXk6ICJmcmllbmRseU5hbWUiLCBhc2NlbmRpbmc6IHRydWUsIHNlbGVjdG9yOiBzb3J0U2VsZWN0b3IpCiAgICBjaGFubmVscyEuc29ydFVzaW5nRGVzY3JpcHRvcnMoW2Rlc2NyaXB0b3JdKQogIH0KCiAgLy8gTUFSSzogLSBDcmVhdGUgY2hhbm5lbAoKICBmdW5jIGNyZWF0ZUNoYW5uZWxXaXRoTmFtZShuYW1lOiBTdHJpbmcsIGNvbXBsZXRpb246IChCb29sLCBUV01DaGFubmVsPykgLT4gVm9pZCkgewogICAgaWYgKG5hbWUgPT0gQ2hhbm5lbE1hbmFnZXIuZGVmYXVsdENoYW5uZWxOYW1lKSB7CiAgICAgIGNvbXBsZXRpb24oZmFsc2UsIG5pbCkKICAgICAgcmV0dXJuCiAgICB9CgogICAgbGV0IGNoYW5uZWxPcHRpb25zOltOU09iamVjdCA6IEFueU9iamVjdF0gPSBbCiAgICAgIFRXTUNoYW5uZWxPcHRpb25GcmllbmRseU5hbWU6IG5hbWUsIFRXTUNoYW5uZWxPcHRpb25UeXBlOiBUV01DaGFubmVsVHlwZS5QdWJsaWMucmF3VmFsdWUKICAgIF0KICAgIFVJQXBwbGljYXRpb24uc2hhcmVkQXBwbGljYXRpb24oKS5uZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlID0gdHJ1ZTsKICAgIHNlbGYuY2hhbm5lbHNMaXN0Py5jcmVhdGVDaGFubmVsV2l0aE9wdGlvbnMoY2hhbm5lbE9wdGlvbnMpIHsgcmVzdWx0LCBjaGFubmVsIGluCiAgICAgIFVJQXBwbGljYXRpb24uc2hhcmVkQXBwbGljYXRpb24oKS5uZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlID0gZmFsc2U7CiAgICAgIGNvbXBsZXRpb24ocmVzdWx0LmlzU3VjY2Vzc2Z1bCgpLCBjaGFubmVsKQogICAgfQogIH0KfQoKLy8gTUFSSzogLSBUd2lsaW9JUE1lc3NhZ2luZ0NsaWVudERlbGVnYXRlCmV4dGVuc2lvbiBDaGFubmVsTWFuYWdlciA6IFR3aWxpb0lQTWVzc2FnaW5nQ2xpZW50RGVsZWdhdGUgewogIGZ1bmMgaXBNZXNzYWdpbmdDbGllbnQoY2xpZW50OiBUd2lsaW9JUE1lc3NhZ2luZ0NsaWVudCEsIGNoYW5uZWxBZGRlZCBjaGFubmVsOiBUV01DaGFubmVsISkgewogICAgZGlzcGF0Y2hfYXN5bmMoZGlzcGF0Y2hfZ2V0X21haW5fcXVldWUoKSwgewogICAgICBpZiBzZWxmLmNoYW5uZWxzICE9IG5pbCB7CiAgICAgICAgc2VsZi5jaGFubmVscyEuYWRkT2JqZWN0KGNoYW5uZWwpCiAgICAgICAgc2VsZi5zb3J0Q2hhbm5lbHMoKQogICAgICB9CiAgICAgIHNlbGYuZGVsZWdhdGU/LmlwTWVzc2FnaW5nQ2xpZW50KGNsaWVudCwgY2hhbm5lbEFkZGVkOiBjaGFubmVsKQogICAgfSkKICB9CgogIGZ1bmMgaXBNZXNzYWdpbmdDbGllbnQoY2xpZW50OiBUd2lsaW9JUE1lc3NhZ2luZ0NsaWVudCEsIGNoYW5uZWxDaGFuZ2VkIGNoYW5uZWw6IFRXTUNoYW5uZWwhKSB7CiAgICBzZWxmLmRlbGVnYXRlPy5pcE1lc3NhZ2luZ0NsaWVudChjbGllbnQsIGNoYW5uZWxDaGFuZ2VkOiBjaGFubmVsKQogIH0KCiAgZnVuYyBpcE1lc3NhZ2luZ0NsaWVudChjbGllbnQ6IFR3aWxpb0lQTWVzc2FnaW5nQ2xpZW50ISwgY2hhbm5lbERlbGV0ZWQgY2hhbm5lbDogVFdNQ2hhbm5lbCEpIHsKICAgIGRpc3BhdGNoX2FzeW5jKGRpc3BhdGNoX2dldF9tYWluX3F1ZXVlKCksIHsKICAgICAgaWYgc2VsZi5jaGFubmVscyAhPSBuaWwgewogICAgICAgIHNlbGYuY2hhbm5lbHM/LnJlbW92ZU9iamVjdChjaGFubmVsKQogICAgICB9CiAgICAgIHNlbGYuZGVsZWdhdGU/LmlwTWVzc2FnaW5nQ2xpZW50KGNsaWVudCwgY2hhbm5lbERlbGV0ZWQ6IGNoYW5uZWwpCiAgICB9KQoKICB9CgogIGZ1bmMgaXBNZXNzYWdpbmdDbGllbnQoY2xpZW50OiBUd2lsaW9JUE1lc3NhZ2luZ0NsaWVudCEsIHN5bmNocm9uaXphdGlvblN0YXR1c0NoYW5nZWQgc3RhdHVzOiBUV01DbGllbnRTeW5jaHJvbml6YXRpb25TdGF0dXMpIHsKICB9Cn0K</textarea>
<textarea class="saurus-file" data-file="twiliochat/MainChatViewController.swift" data-mode="swift">aW1wb3J0IFVJS2l0CmltcG9ydCBTV1JldmVhbFZpZXdDb250cm9sbGVyCmltcG9ydCBTbGFja1RleHRWaWV3Q29udHJvbGxlcgoKY2xhc3MgTWFpbkNoYXRWaWV3Q29udHJvbGxlcjogU0xLVGV4dFZpZXdDb250cm9sbGVyIHsKICBzdGF0aWMgbGV0IFRXQ0NoYXRDZWxsSWRlbnRpZmllciA9ICJDaGF0VGFibGVDZWxsIgogIHN0YXRpYyBsZXQgVFdDQ2hhdFN0YXR1c0NlbGxJZGVudGlmaWVyID0gIkNoYXRTdGF0dXNUYWJsZUNlbGwiCgogIHN0YXRpYyBsZXQgVFdDT3BlbkdlbmVyYWxDaGFubmVsU2VndWUgPSAiT3BlbkdlbmVyYWxDaGF0IgogIHN0YXRpYyBsZXQgVFdDTGFiZWxUYWcgPSAyMDAKCiAgdmFyIF9jaGFubmVsOlRXTUNoYW5uZWwhCiAgdmFyIGNoYW5uZWw6VFdNQ2hhbm5lbCEgewogICAgZ2V0IHsKICAgICAgcmV0dXJuIF9jaGFubmVsCiAgICB9CiAgICBzZXQoY2hhbm5lbCkgewogICAgICBfY2hhbm5lbCA9IGNoYW5uZWwKICAgICAgdGl0bGUgPSBfY2hhbm5lbC5mcmllbmRseU5hbWUKICAgICAgX2NoYW5uZWwuZGVsZWdhdGUgPSBzZWxmCgogICAgICBpZiBfY2hhbm5lbCA9PSBDaGFubmVsTWFuYWdlci5zaGFyZWRNYW5hZ2VyLmdlbmVyYWxDaGFubmVsIHsKICAgICAgICBuYXZpZ2F0aW9uSXRlbS5yaWdodEJhckJ1dHRvbkl0ZW0gPSBuaWwKICAgICAgfQoKICAgICAgam9pbkNoYW5uZWwoKQogICAgfQogIH0KCiAgdmFyIG1lc3NhZ2VzOlNldDxUV01NZXNzYWdlPiA9IFNldDxUV01NZXNzYWdlPigpCiAgdmFyIHNvcnRlZE1lc3NhZ2VzOltUV01NZXNzYWdlXSEKCiAgQElCT3V0bGV0IHdlYWsgdmFyIHJldmVhbEJ1dHRvbkl0ZW06IFVJQmFyQnV0dG9uSXRlbSEKICBASUJPdXRsZXQgd2VhayB2YXIgYWN0aW9uQnV0dG9uSXRlbTogVUlCYXJCdXR0b25JdGVtIQoKICBvdmVycmlkZSBmdW5jIHZpZXdEaWRMb2FkKCkgewogICAgc3VwZXIudmlld0RpZExvYWQoKQoKICAgIGlmIChyZXZlYWxWaWV3Q29udHJvbGxlcigpICE9IG5pbCkgewogICAgICByZXZlYWxCdXR0b25JdGVtLnRhcmdldCA9IHJldmVhbFZpZXdDb250cm9sbGVyKCkKICAgICAgcmV2ZWFsQnV0dG9uSXRlbS5hY3Rpb24gPSAjc2VsZWN0b3IoU1dSZXZlYWxWaWV3Q29udHJvbGxlci5yZXZlYWxUb2dnbGUoXzopKQogICAgICBuYXZpZ2F0aW9uQ29udHJvbGxlcj8ubmF2aWdhdGlvbkJhci5hZGRHZXN0dXJlUmVjb2duaXplcihyZXZlYWxWaWV3Q29udHJvbGxlcigpLnBhbkdlc3R1cmVSZWNvZ25pemVyKCkpCiAgICAgIHJldmVhbFZpZXdDb250cm9sbGVyKCkucmVhclZpZXdSZXZlYWxPdmVyZHJhdyA9IDAKICAgIH0KCiAgICBib3VuY2VzID0gdHJ1ZQogICAgc2hha2VUb0NsZWFyRW5hYmxlZCA9IHRydWUKICAgIGtleWJvYXJkUGFubmluZ0VuYWJsZWQgPSB0cnVlCiAgICBzaG91bGRTY3JvbGxUb0JvdHRvbUFmdGVyS2V5Ym9hcmRTaG93cyA9IGZhbHNlCiAgICBpbnZlcnRlZCA9IHRydWUKCiAgICBsZXQgY2VsbE5pYiA9IFVJTmliKG5pYk5hbWU6IE1haW5DaGF0Vmlld0NvbnRyb2xsZXIuVFdDQ2hhdENlbGxJZGVudGlmaWVyLCBidW5kbGU6IG5pbCkKICAgIHRhYmxlVmlldyEucmVnaXN0ZXJOaWIoY2VsbE5pYiwgZm9yQ2VsbFJldXNlSWRlbnRpZmllcjpNYWluQ2hhdFZpZXdDb250cm9sbGVyLlRXQ0NoYXRDZWxsSWRlbnRpZmllcikKCiAgICBsZXQgY2VsbFN0YXR1c05pYiA9IFVJTmliKG5pYk5hbWU6IE1haW5DaGF0Vmlld0NvbnRyb2xsZXIuVFdDQ2hhdFN0YXR1c0NlbGxJZGVudGlmaWVyLCBidW5kbGU6IG5pbCkKICAgIHRhYmxlVmlldyEucmVnaXN0ZXJOaWIoY2VsbFN0YXR1c05pYiwgZm9yQ2VsbFJldXNlSWRlbnRpZmllcjpNYWluQ2hhdFZpZXdDb250cm9sbGVyLlRXQ0NoYXRTdGF0dXNDZWxsSWRlbnRpZmllcikKCiAgICB0ZXh0SW5wdXRiYXIuYXV0b0hpZGVSaWdodEJ1dHRvbiA9IHRydWUKICAgIHRleHRJbnB1dGJhci5tYXhDaGFyQ291bnQgPSAyNTYKICAgIHRleHRJbnB1dGJhci5jb3VudGVyU3R5bGUgPSAuU3BsaXQKICAgIHRleHRJbnB1dGJhci5jb3VudGVyUG9zaXRpb24gPSAuVG9wCgogICAgbGV0IGZvbnQgPSBVSUZvbnQobmFtZToiQXZlbmlyLUxpZ2h0Iiwgc2l6ZToxNCkKICAgIHRleHRWaWV3LmZvbnQgPSBmb250CgogICAgcmlnaHRCdXR0b24uc2V0VGl0bGVDb2xvcihVSUNvbG9yKHJlZDowLjk3MywgZ3JlZW46MC41NTcsIGJsdWU6MC41MDIsIGFscGhhOjEpLCBmb3JTdGF0ZTogLk5vcm1hbCkKCiAgICBpZiBsZXQgZm9udCA9IFVJRm9udChuYW1lOiJBdmVuaXItSGVhdnkiLCBzaXplOjE3KSB7CiAgICAgIG5hdmlnYXRpb25Db250cm9sbGVyPy5uYXZpZ2F0aW9uQmFyLnRpdGxlVGV4dEF0dHJpYnV0ZXMgPSBbTlNGb250QXR0cmlidXRlTmFtZTogZm9udF0KICAgIH0KCiAgICB0YWJsZVZpZXchLmFsbG93c1NlbGVjdGlvbiA9IGZhbHNlCiAgICB0YWJsZVZpZXchLmVzdGltYXRlZFJvd0hlaWdodCA9IDcwCiAgICB0YWJsZVZpZXchLnJvd0hlaWdodCA9IFVJVGFibGVWaWV3QXV0b21hdGljRGltZW5zaW9uCiAgICB0YWJsZVZpZXchLnNlcGFyYXRvclN0eWxlID0gLk5vbmUKCiAgICBpZiBjaGFubmVsID09IG5pbCB7CiAgICAgIGNoYW5uZWwgPSBDaGFubmVsTWFuYWdlci5zaGFyZWRNYW5hZ2VyLmdlbmVyYWxDaGFubmVsCiAgICB9CiAgfQoKICBvdmVycmlkZSBmdW5jIHZpZXdEaWRBcHBlYXIoYW5pbWF0ZWQ6IEJvb2wpIHsKICAgIHN1cGVyLnZpZXdEaWRBcHBlYXIoYW5pbWF0ZWQpCiAgICBzY3JvbGxUb0JvdHRvbSgpCiAgfQoKICBvdmVycmlkZSBmdW5jIG51bWJlck9mU2VjdGlvbnNJblRhYmxlVmlldyh0YWJsZVZpZXc6IFVJVGFibGVWaWV3KSAtPiBJbnQgewogICAgcmV0dXJuIDEKICB9CgogIG92ZXJyaWRlIGZ1bmMgdGFibGVWaWV3KHRhYmxlVmlldzogVUlUYWJsZVZpZXcsIG51bWJlck9mUm93c0luU2VjdGlvbiBzZWN0aW9uOiBOU0ludGVnZXIpIC0+IEludCB7CiAgICByZXR1cm4gbWVzc2FnZXMuY291bnQKICB9CgogIG92ZXJyaWRlIGZ1bmMgdGFibGVWaWV3KHRhYmxlVmlldzogVUlUYWJsZVZpZXcsIGNlbGxGb3JSb3dBdEluZGV4UGF0aCBpbmRleFBhdGg6IE5TSW5kZXhQYXRoKSAtPiBVSVRhYmxlVmlld0NlbGwgewogICAgdmFyIGNlbGw6VUlUYWJsZVZpZXdDZWxsCgogICAgbGV0IG1lc3NhZ2UgPSBzb3J0ZWRNZXNzYWdlc1tpbmRleFBhdGgucm93XQoKICAgIGlmIGxldCBzdGF0dXNNZXNzYWdlID0gbWVzc2FnZSBhcz8gU3RhdHVzTWVzc2FnZSB7CiAgICAgIGNlbGwgPSBnZXRTdGF0dXNDZWxsRm9yVGFibGVWaWV3KHRhYmxlVmlldywgZm9ySW5kZXhQYXRoOmluZGV4UGF0aCwgbWVzc2FnZTpzdGF0dXNNZXNzYWdlKQogICAgfQogICAgZWxzZSB7CiAgICAgIGNlbGwgPSBnZXRDaGF0Q2VsbEZvclRhYmxlVmlldyh0YWJsZVZpZXcsIGZvckluZGV4UGF0aDppbmRleFBhdGgsIG1lc3NhZ2U6bWVzc2FnZSkKICAgIH0KCiAgICBjZWxsLnRyYW5zZm9ybSA9IHRhYmxlVmlldy50cmFuc2Zvcm0KICAgIHJldHVybiBjZWxsCiAgfQoKICBmdW5jIGdldENoYXRDZWxsRm9yVGFibGVWaWV3KHRhYmxlVmlldzogVUlUYWJsZVZpZXcsIGZvckluZGV4UGF0aCBpbmRleFBhdGg6TlNJbmRleFBhdGgsIG1lc3NhZ2U6IFRXTU1lc3NhZ2UpIC0+IFVJVGFibGVWaWV3Q2VsbCB7CiAgICBsZXQgY2VsbCA9IHRhYmxlVmlldy5kZXF1ZXVlUmV1c2FibGVDZWxsV2l0aElkZW50aWZpZXIoTWFpbkNoYXRWaWV3Q29udHJvbGxlci5UV0NDaGF0Q2VsbElkZW50aWZpZXIsIGZvckluZGV4UGF0aDppbmRleFBhdGgpCgogICAgbGV0IGNoYXRDZWxsOiBDaGF0VGFibGVDZWxsID0gY2VsbCBhcyEgQ2hhdFRhYmxlQ2VsbAogICAgbGV0IHRpbWVzdGFtcCA9IERhdGVUb2RheUZvcm1hdHRlcigpLnN0cmluZ0Zyb21EYXRlKE5TRGF0ZS5kYXRlV2l0aElTTzg2MDFTdHJpbmcobWVzc2FnZS50aW1lc3RhbXApKQoKICAgIGNoYXRDZWxsLnNldFVzZXIobWVzc2FnZS5hdXRob3IgPz8gIltVbmtub3duIGF1dGhvcl0iLCBtZXNzYWdlOiBtZXNzYWdlLmJvZHksIGRhdGU6IHRpbWVzdGFtcCA/PyAiW1Vua25vd24gZGF0ZV0iKQoKICAgIHJldHVybiBjaGF0Q2VsbAogIH0KCiAgZnVuYyBnZXRTdGF0dXNDZWxsRm9yVGFibGVWaWV3KHRhYmxlVmlldzogVUlUYWJsZVZpZXcsIGZvckluZGV4UGF0aCBpbmRleFBhdGg6TlNJbmRleFBhdGgsIG1lc3NhZ2U6IFN0YXR1c01lc3NhZ2UpIC0+IFVJVGFibGVWaWV3Q2VsbCB7CiAgICBsZXQgY2VsbCA9IHRhYmxlVmlldy5kZXF1ZXVlUmV1c2FibGVDZWxsV2l0aElkZW50aWZpZXIoTWFpbkNoYXRWaWV3Q29udHJvbGxlci5UV0NDaGF0U3RhdHVzQ2VsbElkZW50aWZpZXIsIGZvckluZGV4UGF0aDppbmRleFBhdGgpCgogICAgbGV0IGxhYmVsID0gY2VsbC52aWV3V2l0aFRhZyhNYWluQ2hhdFZpZXdDb250cm9sbGVyLlRXQ0xhYmVsVGFnKSBhcyEgVUlMYWJlbAogICAgbGV0IG1lbWJlclN0YXR1cyA9IChtZXNzYWdlLnN0YXR1cyEgPT0gLkpvaW5lZCkgPyAiam9pbmVkIiA6ICJsZWZ0IgogICAgbGFiZWwudGV4dCA9ICJVc2VyIFwobWVzc2FnZS5tZW1iZXIudXNlckluZm8uaWRlbnRpdHkpIGhhcyBcKG1lbWJlclN0YXR1cykiCiAgICByZXR1cm4gY2VsbAogIH0KCiAgZnVuYyBqb2luQ2hhbm5lbCgpIHsKICAgIHNldFZpZXdPbkhvbGQodHJ1ZSkKCiAgICBpZiBjaGFubmVsLnN0YXR1cyAhPSAuSm9pbmVkIHsKICAgICAgY2hhbm5lbC5qb2luV2l0aENvbXBsZXRpb24geyByZXN1bHQgaW4KICAgICAgICBwcmludCgiQ2hhbm5lbCBKb2luZWQiKQogICAgICB9CiAgICB9CgogICAgaWYgY2hhbm5lbC5zeW5jaHJvbml6YXRpb25TdGF0dXMgIT0gLkFsbCB7CiAgICAgIGNoYW5uZWwuc3luY2hyb25pemVXaXRoQ29tcGxldGlvbiB7IHJlc3VsdCBpbgogICAgICAgIGlmIHJlc3VsdC5pc1N1Y2Nlc3NmdWwoKSB7CiAgICAgICAgICBwcmludCgiU3luY2hyb25pemF0aW9uIHN0YXJ0ZWQuIERlbGVnYXRlIG1ldGhvZCB3aWxsIGxvYWQgbWVzc2FnZXMiKQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgIGxvYWRNZXNzYWdlcygpCiAgICAgIHNldFZpZXdPbkhvbGQoZmFsc2UpCiAgICB9CgogIH0KCiAgLy8gRGlzYWJsZSB1c2VyIGlucHV0IGFuZCBzaG93IGFjdGl2aXR5IGluZGljYXRvcgogIGZ1bmMgc2V0Vmlld09uSG9sZChvbkhvbGQ6IEJvb2wpIHsKICAgIHNlbGYudGV4dElucHV0YmFySGlkZGVuID0gb25Ib2xkOwogICAgVUlBcHBsaWNhdGlvbi5zaGFyZWRBcHBsaWNhdGlvbigpLm5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGUgPSBvbkhvbGQ7CiAgfQoKICBvdmVycmlkZSBmdW5jIGRpZFByZXNzUmlnaHRCdXR0b24oc2VuZGVyOiBBbnlPYmplY3QhKSB7CiAgICB0ZXh0Vmlldy5yZWZyZXNoRmlyc3RSZXNwb25kZXIoKQogICAgc2VuZE1lc3NhZ2UodGV4dFZpZXcudGV4dCkKICAgIHN1cGVyLmRpZFByZXNzUmlnaHRCdXR0b24oc2VuZGVyKQogIH0KCiAgLy8gTUFSSzogLSBDaGF0IFNlcnZpY2UKCiAgZnVuYyBzZW5kTWVzc2FnZShpbnB1dE1lc3NhZ2U6IFN0cmluZykgewogICAgbGV0IG1lc3NhZ2UgPSBjaGFubmVsLm1lc3NhZ2VzLmNyZWF0ZU1lc3NhZ2VXaXRoQm9keShpbnB1dE1lc3NhZ2UpCiAgICBjaGFubmVsLm1lc3NhZ2VzLnNlbmRNZXNzYWdlKG1lc3NhZ2UsIGNvbXBsZXRpb246IG5pbCkKICB9CgogIGZ1bmMgYWRkTWVzc2FnZXMobmV3TWVzc2FnZXM6W1RXTU1lc3NhZ2VdKSB7CiAgICBtZXNzYWdlcyA9ICBtZXNzYWdlcy51bmlvbihuZXdNZXNzYWdlcykKICAgIHNvcnRNZXNzYWdlcygpCiAgICBkaXNwYXRjaF9hc3luYyhkaXNwYXRjaF9nZXRfbWFpbl9xdWV1ZSgpLCB7CiAgICAgIHNlbGYudGFibGVWaWV3IS5yZWxvYWREYXRhKCkKICAgICAgaWYgc2VsZi5tZXNzYWdlcy5jb3VudCA+IDAgewogICAgICAgIHNlbGYuc2Nyb2xsVG9Cb3R0b20oKQogICAgICB9CiAgICB9KQogIH0KCiAgZnVuYyBzb3J0TWVzc2FnZXMoKSB7CiAgICBzb3J0ZWRNZXNzYWdlcyA9IG1lc3NhZ2VzLnNvcnQgeyBhLCBiIGluIGEudGltZXN0YW1wID4gYi50aW1lc3RhbXAgfQogIH0KCiAgZnVuYyBsb2FkTWVzc2FnZXMoKSB7CiAgICBtZXNzYWdlcy5yZW1vdmVBbGwoKQogICAgaWYgY2hhbm5lbC5zeW5jaHJvbml6YXRpb25TdGF0dXMgPT0gLkFsbCB7CiAgICAgIGFkZE1lc3NhZ2VzKGNoYW5uZWwubWVzc2FnZXMuYWxsT2JqZWN0cygpKQogICAgfQogIH0KCiAgZnVuYyBzY3JvbGxUb0JvdHRvbSgpIHsKICAgIGlmIG1lc3NhZ2VzLmNvdW50ID4gMCB7CiAgICAgIGxldCBpbmRleFBhdGggPSBOU0luZGV4UGF0aChmb3JSb3c6IDAsIGluU2VjdGlvbjogMCkKICAgICAgdGFibGVWaWV3IS5zY3JvbGxUb1Jvd0F0SW5kZXhQYXRoKGluZGV4UGF0aCwgYXRTY3JvbGxQb3NpdGlvbjogLkJvdHRvbSwgYW5pbWF0ZWQ6IHRydWUpCiAgICB9CiAgfQoKICBmdW5jIGxlYXZlQ2hhbm5lbCgpIHsKICAgIGNoYW5uZWwubGVhdmVXaXRoQ29tcGxldGlvbiB7IHJlc3VsdCBpbgogICAgICBpZiByZXN1bHQuaXNTdWNjZXNzZnVsKCkgewogICAgICAgIGxldCBtZW51Vmlld0NvbnRyb2xsZXIgPSBzZWxmLnJldmVhbFZpZXdDb250cm9sbGVyKCkucmVhclZpZXdDb250cm9sbGVyIGFzISBNZW51Vmlld0NvbnRyb2xsZXIKICAgICAgICBtZW51Vmlld0NvbnRyb2xsZXIuZGVzZWxlY3RTZWxlY3RlZENoYW5uZWwoKQogICAgICAgIHNlbGYucmV2ZWFsVmlld0NvbnRyb2xsZXIoKS5yZWFyVmlld0NvbnRyb2xsZXIucGVyZm9ybVNlZ3VlV2l0aElkZW50aWZpZXIoTWFpbkNoYXRWaWV3Q29udHJvbGxlci5UV0NPcGVuR2VuZXJhbENoYW5uZWxTZWd1ZSwgc2VuZGVyOiBuaWwpCiAgICAgIH0KICAgIH0KICB9CgogIC8vIE1BUks6IC0gQWN0aW9ucwoKICBASUJBY3Rpb24gZnVuYyBhY3Rpb25CdXR0b25Ub3VjaGVkKHNlbmRlcjogVUlCYXJCdXR0b25JdGVtKSB7CiAgICBsZWF2ZUNoYW5uZWwoKQogIH0KCiAgQElCQWN0aW9uIGZ1bmMgcmV2ZWFsQnV0dG9uVG91Y2hlZChzZW5kZXI6IEFueU9iamVjdCkgewogICAgcmV2ZWFsVmlld0NvbnRyb2xsZXIoKS5yZXZlYWxUb2dnbGVBbmltYXRlZCh0cnVlKQogIH0KfQoKZXh0ZW5zaW9uIE1haW5DaGF0Vmlld0NvbnRyb2xsZXIgOiBUV01DaGFubmVsRGVsZWdhdGUgewogIGZ1bmMgaXBNZXNzYWdpbmdDbGllbnQoY2xpZW50OiBUd2lsaW9JUE1lc3NhZ2luZ0NsaWVudCEsIGNoYW5uZWw6IFRXTUNoYW5uZWwhLCBtZXNzYWdlQWRkZWQgbWVzc2FnZTogVFdNTWVzc2FnZSEpIHsKICAgIGlmICFtZXNzYWdlcy5jb250YWlucyhtZXNzYWdlKSB7CiAgICAgIGFkZE1lc3NhZ2VzKFttZXNzYWdlXSkKICAgIH0KICB9CgogIGZ1bmMgaXBNZXNzYWdpbmdDbGllbnQoY2xpZW50OiBUd2lsaW9JUE1lc3NhZ2luZ0NsaWVudCEsIGNoYW5uZWw6IFRXTUNoYW5uZWwhLCBtZW1iZXJKb2luZWQgbWVtYmVyOiBUV01NZW1iZXIhKSB7CiAgICBhZGRNZXNzYWdlcyhbU3RhdHVzTWVzc2FnZShtZW1iZXI6bWVtYmVyLCBzdGF0dXM6LkpvaW5lZCldKQogIH0KCiAgZnVuYyBpcE1lc3NhZ2luZ0NsaWVudChjbGllbnQ6IFR3aWxpb0lQTWVzc2FnaW5nQ2xpZW50ISwgY2hhbm5lbDogVFdNQ2hhbm5lbCEsIG1lbWJlckxlZnQgbWVtYmVyOiBUV01NZW1iZXIhKSB7CiAgICBhZGRNZXNzYWdlcyhbU3RhdHVzTWVzc2FnZShtZW1iZXI6bWVtYmVyLCBzdGF0dXM6LkxlZnQpXSkKICB9CgogIGZ1bmMgaXBNZXNzYWdpbmdDbGllbnQoY2xpZW50OiBUd2lsaW9JUE1lc3NhZ2luZ0NsaWVudCEsIGNoYW5uZWxEZWxldGVkIGNoYW5uZWw6IFRXTUNoYW5uZWwhKSB7CiAgICBkaXNwYXRjaF9hc3luYyhkaXNwYXRjaF9nZXRfbWFpbl9xdWV1ZSgpLCB7CiAgICAgIGlmIGNoYW5uZWwgPT0gc2VsZi5jaGFubmVsIHsKICAgICAgICBzZWxmLnJldmVhbFZpZXdDb250cm9sbGVyKCkucmVhclZpZXdDb250cm9sbGVyCiAgICAgICAgICAucGVyZm9ybVNlZ3VlV2l0aElkZW50aWZpZXIoTWFpbkNoYXRWaWV3Q29udHJvbGxlci5UV0NPcGVuR2VuZXJhbENoYW5uZWxTZWd1ZSwgc2VuZGVyOiBuaWwpCiAgICAgIH0KICAgIH0pCiAgfQoKICBmdW5jIGlwTWVzc2FnaW5nQ2xpZW50KGNsaWVudDogVHdpbGlvSVBNZXNzYWdpbmdDbGllbnQhLCBjaGFubmVsOiBUV01DaGFubmVsISwgc3luY2hyb25pemF0aW9uU3RhdHVzQ2hhbmdlZCBzdGF0dXM6IFRXTUNoYW5uZWxTeW5jaHJvbml6YXRpb25TdGF0dXMpIHsKICAgIGlmIHN0YXR1cyA9PSAuQWxsIHsKICAgICAgbG9hZE1lc3NhZ2VzKCkKICAgICAgZGlzcGF0Y2hfYXN5bmMoZGlzcGF0Y2hfZ2V0X21haW5fcXVldWUoKSwgewogICAgICAgIHNlbGYudGFibGVWaWV3Py5yZWxvYWREYXRhKCkKICAgICAgICBzZWxmLnNldFZpZXdPbkhvbGQoZmFsc2UpCiAgICAgIH0pCiAgICB9CiAgfQp9Cg==</textarea>
<textarea class="saurus-file" data-file="twiliochat/MenuViewController.swift" data-mode="swift">aW1wb3J0IFVJS2l0CgpjbGFzcyBNZW51Vmlld0NvbnRyb2xsZXI6IFVJVmlld0NvbnRyb2xsZXIgewogIHN0YXRpYyBsZXQgVFdDT3BlbkNoYW5uZWxTZWd1ZSA9ICJPcGVuQ2hhdCIKICBzdGF0aWMgbGV0IFRXQ1JlZnJlc2hDb250cm9sWE9mZnNldDogQ0dGbG9hdCA9IDEyMAoKICBASUJPdXRsZXQgd2VhayB2YXIgdGFibGVWaWV3OiBVSVRhYmxlVmlldyEKICBASUJPdXRsZXQgd2VhayB2YXIgdXNlcm5hbWVMYWJlbDogVUlMYWJlbCEKCiAgdmFyIHJlZnJlc2hDb250cm9sOiBVSVJlZnJlc2hDb250cm9sIQoKICBvdmVycmlkZSBmdW5jIHZpZXdEaWRMb2FkKCkgewogICAgc3VwZXIudmlld0RpZExvYWQoKQoKICAgIGxldCBiZ0ltYWdlID0gVUlJbWFnZVZpZXcoaW1hZ2U6IFVJSW1hZ2UobmFtZWQ6ImhvbWUtYmciKSkKICAgIGJnSW1hZ2UuZnJhbWUgPSBzZWxmLnRhYmxlVmlldy5mcmFtZQogICAgdGFibGVWaWV3LmJhY2tncm91bmRWaWV3ID0gYmdJbWFnZQoKICAgIHVzZXJuYW1lTGFiZWwudGV4dCA9IElQTWVzc2FnaW5nTWFuYWdlci5zaGFyZWRNYW5hZ2VyKCkudXNlcklkZW50aXR5CgogICAgcmVmcmVzaENvbnRyb2wgPSBVSVJlZnJlc2hDb250cm9sKCkKICAgIHRhYmxlVmlldy5hZGRTdWJ2aWV3KHJlZnJlc2hDb250cm9sKQogICAgcmVmcmVzaENvbnRyb2wuYWRkVGFyZ2V0KHNlbGYsIGFjdGlvbjogI3NlbGVjdG9yKE1lbnVWaWV3Q29udHJvbGxlci5yZWZyZXNoQ2hhbm5lbHMpLCBmb3JDb250cm9sRXZlbnRzOiAuVmFsdWVDaGFuZ2VkKQogICAgcmVmcmVzaENvbnRyb2wudGludENvbG9yID0gVUlDb2xvci53aGl0ZUNvbG9yKCkKCiAgICBzZWxmLnJlZnJlc2hDb250cm9sLmZyYW1lLm9yaWdpbi54IC09IE1lbnVWaWV3Q29udHJvbGxlci5UV0NSZWZyZXNoQ29udHJvbFhPZmZzZXQKICAgIENoYW5uZWxNYW5hZ2VyLnNoYXJlZE1hbmFnZXIuZGVsZWdhdGUgPSBzZWxmCiAgICByZWxvYWRDaGFubmVsTGlzdCgpCiAgfQoKICAvLyBNQVJLOiAtIEludGVybmFsIG1ldGhvZHMKCiAgZnVuYyBsb2FkaW5nQ2VsbEZvclRhYmxlVmlldyh0YWJsZVZpZXc6IFVJVGFibGVWaWV3KSAtPiBVSVRhYmxlVmlld0NlbGwgewogICAgcmV0dXJuIHRhYmxlVmlldy5kZXF1ZXVlUmV1c2FibGVDZWxsV2l0aElkZW50aWZpZXIoImxvYWRpbmdDZWxsIikhCiAgfQoKICBmdW5jIGNoYW5uZWxDZWxsRm9yVGFibGVWaWV3KHRhYmxlVmlldzogVUlUYWJsZVZpZXcsIGF0SW5kZXhQYXRoIGluZGV4UGF0aDogTlNJbmRleFBhdGgpIC0+IFVJVGFibGVWaWV3Q2VsbCB7CiAgICBsZXQgbWVudUNlbGwgPSB0YWJsZVZpZXcuZGVxdWV1ZVJldXNhYmxlQ2VsbFdpdGhJZGVudGlmaWVyKCJjaGFubmVsQ2VsbCIsIGZvckluZGV4UGF0aDogaW5kZXhQYXRoKSBhcyEgTWVudVRhYmxlQ2VsbAoKICAgIGxldCBjaGFubmVsID0gQ2hhbm5lbE1hbmFnZXIuc2hhcmVkTWFuYWdlci5jaGFubmVscyFbaW5kZXhQYXRoLnJvd10KICAgIHZhciBmcmllbmRseU5hbWUgPSBjaGFubmVsLmZyaWVuZGx5TmFtZQogICAgaWYgbGV0IG5hbWUgPSBjaGFubmVsLmZyaWVuZGx5TmFtZSB3aGVyZSBuYW1lLmlzRW1wdHkgewogICAgICBmcmllbmRseU5hbWUgPSBuYW1lCiAgICB9CiAgICBtZW51Q2VsbC5jaGFubmVsTmFtZSA9IGZyaWVuZGx5TmFtZQogICAgcmV0dXJuIG1lbnVDZWxsCiAgfQoKICBmdW5jIHJlbG9hZENoYW5uZWxMaXN0KCkgewogICAgdGFibGVWaWV3LnJlbG9hZERhdGEoKQogICAgcmVmcmVzaENvbnRyb2wuZW5kUmVmcmVzaGluZygpCiAgfQoKICBmdW5jIHJlZnJlc2hDaGFubmVscygpIHsKICAgIHJlZnJlc2hDb250cm9sLmJlZ2luUmVmcmVzaGluZygpCiAgICByZWxvYWRDaGFubmVsTGlzdCgpCiAgfQoKICBmdW5jIGRlc2VsZWN0U2VsZWN0ZWRDaGFubmVsKCkgewogICAgbGV0IHNlbGVjdGVkUm93ID0gdGFibGVWaWV3LmluZGV4UGF0aEZvclNlbGVjdGVkUm93CiAgICBpZiBsZXQgcm93ID0gc2VsZWN0ZWRSb3cgewogICAgICB0YWJsZVZpZXcuZGVzZWxlY3RSb3dBdEluZGV4UGF0aChyb3csIGFuaW1hdGVkOiB0cnVlKQogICAgfQogIH0KCiAgLy8gTUFSSzogLSBDaGFubmVsCgogIGZ1bmMgY3JlYXRlTmV3Q2hhbm5lbERpYWxvZygpIHsKICAgIElucHV0RGlhbG9nQ29udHJvbGxlci5zaG93V2l0aFRpdGxlKCJOZXcgQ2hhbm5lbCIsCiAgICAgIG1lc3NhZ2U6ICJFbnRlciBhIG5hbWUgZm9yIHRoaXMgY2hhbm5lbCIsCiAgICAgIHBsYWNlaG9sZGVyOiAiTmFtZSIsCiAgICAgIHByZXNlbnRlcjogc2VsZikgeyB0ZXh0IGluCiAgICAgICAgQ2hhbm5lbE1hbmFnZXIuc2hhcmVkTWFuYWdlci5jcmVhdGVDaGFubmVsV2l0aE5hbWUodGV4dCwgY29tcGxldGlvbjogeyBfLF8gaW4gfSkKICAgIH0KICB9CgogIC8vIE1BUks6IExvZ291dAoKICBmdW5jIHByb21wdExvZ291dCgpIHsKICAgIGxldCBhbGVydCA9IFVJQWxlcnRDb250cm9sbGVyKHRpdGxlOiBuaWwsIG1lc3NhZ2U6ICJZb3UgYXJlIGFib3V0IHRvIExvZ291dCIsIHByZWZlcnJlZFN0eWxlOiAuQWxlcnQpCgogICAgbGV0IGNhbmNlbEFjdGlvbiA9IFVJQWxlcnRBY3Rpb24odGl0bGU6ICJDYW5jZWwiLCBzdHlsZTogLkNhbmNlbCwgaGFuZGxlcjogbmlsKQogICAgbGV0IGNvbmZpcm1BY3Rpb24gPSBVSUFsZXJ0QWN0aW9uKHRpdGxlOiAiQ29uZmlybSIsIHN0eWxlOiAuRGVmYXVsdCkgeyBhY3Rpb24gaW4KICAgICAgc2VsZi5sb2dPdXQoKQogICAgfQoKICAgIGFsZXJ0LmFkZEFjdGlvbihjYW5jZWxBY3Rpb24pCiAgICBhbGVydC5hZGRBY3Rpb24oY29uZmlybUFjdGlvbikKICAgIHByZXNlbnRWaWV3Q29udHJvbGxlcihhbGVydCwgYW5pbWF0ZWQ6IHRydWUsIGNvbXBsZXRpb246IG5pbCkKICB9CgogIGZ1bmMgbG9nT3V0KCkgewogICAgSVBNZXNzYWdpbmdNYW5hZ2VyLnNoYXJlZE1hbmFnZXIoKS5sb2dvdXQoKQogICAgSVBNZXNzYWdpbmdNYW5hZ2VyLnNoYXJlZE1hbmFnZXIoKS5wcmVzZW50Um9vdFZpZXdDb250cm9sbGVyKCkKICB9CgogIC8vIE1BUks6IC0gQWN0aW9ucwoKICBASUJBY3Rpb24gZnVuYyBsb2dvdXRCdXR0b25Ub3VjaGVkKHNlbmRlcjogVUlCdXR0b24pIHsKICAgIHByb21wdExvZ291dCgpCiAgfQoKICBASUJBY3Rpb24gZnVuYyBuZXdDaGFubmVsQnV0dG9uVG91Y2hlZChzZW5kZXI6IFVJQnV0dG9uKSB7CiAgICBjcmVhdGVOZXdDaGFubmVsRGlhbG9nKCkKICB9CgogIC8vIE1BUks6IC0gTmF2aWdhdGlvbgoKICBvdmVycmlkZSBmdW5jIHByZXBhcmVGb3JTZWd1ZShzZWd1ZTogVUlTdG9yeWJvYXJkU2VndWUsIHNlbmRlcjogQW55T2JqZWN0PykgewogICAgaWYgc2VndWUuaWRlbnRpZmllciA9PSBNZW51Vmlld0NvbnRyb2xsZXIuVFdDT3BlbkNoYW5uZWxTZWd1ZSB7CiAgICAgIGxldCBpbmRleFBhdGggPSBzZW5kZXIgYXMhIE5TSW5kZXhQYXRoCiAgICAgIGxldCBjaGFubmVsID0gQ2hhbm5lbE1hbmFnZXIuc2hhcmVkTWFuYWdlci5jaGFubmVscyFbaW5kZXhQYXRoLnJvd10gYXMhIFRXTUNoYW5uZWwKICAgICAgbGV0IG5hdmlnYXRpb25Db250cm9sbGVyID0gc2VndWUuZGVzdGluYXRpb25WaWV3Q29udHJvbGxlciBhcyEgVUlOYXZpZ2F0aW9uQ29udHJvbGxlcgogICAgICAobmF2aWdhdGlvbkNvbnRyb2xsZXIudmlzaWJsZVZpZXdDb250cm9sbGVyIGFzISBNYWluQ2hhdFZpZXdDb250cm9sbGVyKS5jaGFubmVsID0gY2hhbm5lbAogICAgfQogIH0KCiAgLy8gTUFSSzogLSBTdHlsZQoKICBvdmVycmlkZSBmdW5jIHByZWZlcnJlZFN0YXR1c0JhclN0eWxlKCkgLT4gVUlTdGF0dXNCYXJTdHlsZSB7CiAgICByZXR1cm4gLkxpZ2h0Q29udGVudAogIH0KfQoKLy8gTUFSSzogLSBVSVRhYmxlVmlld0RhdGFTb3VyY2UKZXh0ZW5zaW9uIE1lbnVWaWV3Q29udHJvbGxlciA6IFVJVGFibGVWaWV3RGF0YVNvdXJjZSB7CiAgZnVuYyB0YWJsZVZpZXcodGFibGVWaWV3OiBVSVRhYmxlVmlldywgbnVtYmVyT2ZSb3dzSW5TZWN0aW9uIHNlY3Rpb246IEludCkgLT4gSW50IHsKICAgIGlmIGxldCBjaGFubmVscyA9IENoYW5uZWxNYW5hZ2VyLnNoYXJlZE1hbmFnZXIuY2hhbm5lbHMgewogICAgICByZXR1cm4gY2hhbm5lbHMuY291bnQKICAgIH0KICAgIHJldHVybiAxCiAgfQoKICBmdW5jIHRhYmxlVmlldyh0YWJsZVZpZXc6IFVJVGFibGVWaWV3LCBjZWxsRm9yUm93QXRJbmRleFBhdGggaW5kZXhQYXRoOiBOU0luZGV4UGF0aCkgLT4gVUlUYWJsZVZpZXdDZWxsIHsKICAgIGxldCBjZWxsOiBVSVRhYmxlVmlld0NlbGwKCiAgICBpZiBDaGFubmVsTWFuYWdlci5zaGFyZWRNYW5hZ2VyLmNoYW5uZWxzID09IG5pbCB7CiAgICAgIGNlbGwgPSBsb2FkaW5nQ2VsbEZvclRhYmxlVmlldyh0YWJsZVZpZXcpCiAgICB9CiAgICBlbHNlIHsKICAgICAgY2VsbCA9IGNoYW5uZWxDZWxsRm9yVGFibGVWaWV3KHRhYmxlVmlldywgYXRJbmRleFBhdGg6IGluZGV4UGF0aCkKICAgIH0KCiAgICBjZWxsLmxheW91dElmTmVlZGVkKCkKICAgIHJldHVybiBjZWxsCiAgfQoKICBmdW5jIHRhYmxlVmlldyh0YWJsZVZpZXc6IFVJVGFibGVWaWV3LCBjYW5FZGl0Um93QXRJbmRleFBhdGggaW5kZXhQYXRoOiBOU0luZGV4UGF0aCkgLT4gQm9vbCB7CiAgICBpZiBsZXQgY2hhbm5lbCA9IENoYW5uZWxNYW5hZ2VyLnNoYXJlZE1hbmFnZXIuY2hhbm5lbHM/Lm9iamVjdEF0SW5kZXgoaW5kZXhQYXRoLnJvdykgYXM/IFRXTUNoYW5uZWwgewogICAgICByZXR1cm4gY2hhbm5lbCAhPSBDaGFubmVsTWFuYWdlci5zaGFyZWRNYW5hZ2VyLmdlbmVyYWxDaGFubmVsCiAgICB9CiAgICByZXR1cm4gZmFsc2UKICB9CgogIGZ1bmMgdGFibGVWaWV3KHRhYmxlVmlldzogVUlUYWJsZVZpZXcsIGNvbW1pdEVkaXRpbmdTdHlsZSBlZGl0aW5nU3R5bGU6IFVJVGFibGVWaWV3Q2VsbEVkaXRpbmdTdHlsZSwKICAgIGZvclJvd0F0SW5kZXhQYXRoIGluZGV4UGF0aDogTlNJbmRleFBhdGgpIHsKICAgICAgaWYgZWRpdGluZ1N0eWxlICE9IC5EZWxldGUgewogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIGlmIGxldCBjaGFubmVsID0gQ2hhbm5lbE1hbmFnZXIuc2hhcmVkTWFuYWdlci5jaGFubmVscz8ub2JqZWN0QXRJbmRleChpbmRleFBhdGgucm93KSB7CiAgICAgICAgY2hhbm5lbC5kZXN0cm95V2l0aENvbXBsZXRpb24geyByZXN1bHQgaW4KICAgICAgICAgIGlmIHJlc3VsdC5pc1N1Y2Nlc3NmdWwoKSB7CiAgICAgICAgICAgIHRhYmxlVmlldy5yZWxvYWREYXRhKCkKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBBbGVydERpYWxvZ0NvbnRyb2xsZXIuc2hvd0FsZXJ0V2l0aE1lc3NhZ2UoIllvdSBjYW4gbm90IGRlbGV0ZSB0aGlzIGNoYW5uZWwiLCB0aXRsZTogbmlsLCBwcmVzZW50ZXI6IHNlbGYpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgfQp9CgovLyBNQVJLOiAtIFVJVGFibGVWaWV3RGVsZWdhdGUKZXh0ZW5zaW9uIE1lbnVWaWV3Q29udHJvbGxlciA6IFVJVGFibGVWaWV3RGVsZWdhdGUgewogIGZ1bmMgdGFibGVWaWV3KHRhYmxlVmlldzogVUlUYWJsZVZpZXcsIGRpZFNlbGVjdFJvd0F0SW5kZXhQYXRoIGluZGV4UGF0aDogTlNJbmRleFBhdGgpIHsKICAgIHBlcmZvcm1TZWd1ZVdpdGhJZGVudGlmaWVyKE1lbnVWaWV3Q29udHJvbGxlci5UV0NPcGVuQ2hhbm5lbFNlZ3VlLCBzZW5kZXI6IGluZGV4UGF0aCkKICB9Cn0KCi8vIE1BUks6IC0gVHdpbGlvSVBNZXNzYWdpbmdDbGllbnREZWxlZ2F0ZQpleHRlbnNpb24gTWVudVZpZXdDb250cm9sbGVyIDogVHdpbGlvSVBNZXNzYWdpbmdDbGllbnREZWxlZ2F0ZSB7CiAgZnVuYyBpcE1lc3NhZ2luZ0NsaWVudChjbGllbnQ6IFR3aWxpb0lQTWVzc2FnaW5nQ2xpZW50ISwgY2hhbm5lbEFkZGVkIGNoYW5uZWw6IFRXTUNoYW5uZWwhKSB7CiAgICB0YWJsZVZpZXcucmVsb2FkRGF0YSgpCiAgfQoKICBmdW5jIGlwTWVzc2FnaW5nQ2xpZW50KGNsaWVudDogVHdpbGlvSVBNZXNzYWdpbmdDbGllbnQhLCBjaGFubmVsQ2hhbmdlZCBjaGFubmVsOiBUV01DaGFubmVsISkgewogICAgdGFibGVWaWV3LnJlbG9hZERhdGEoKQogIH0KCiAgZnVuYyBpcE1lc3NhZ2luZ0NsaWVudChjbGllbnQ6IFR3aWxpb0lQTWVzc2FnaW5nQ2xpZW50ISwgY2hhbm5lbERlbGV0ZWQgY2hhbm5lbDogVFdNQ2hhbm5lbCEpIHsKICAgIHRhYmxlVmlldy5yZWxvYWREYXRhKCkKICB9Cn0K</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/twiliochat-swift" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>